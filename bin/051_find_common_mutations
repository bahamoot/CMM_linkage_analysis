#!/bin/bash

script_dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

tmp_dir="$script_dir/tmp"
tmp_first_member="$tmp_dir/tmp_first_member"
tmp_second_member="$tmp_dir/tmp_second_member"
tmp_homozygous1="$tmp_dir/tmp_homozygous11"
tmp_homozygous2="$tmp_dir/tmp_homozygous21"
tmp_homozygous3="$tmp_dir/tmp_homozygous31.csv.tab.csv"
tmp_common_mutations="$tmp_dir/tmp_common_mutations.csv"

#---------- input --------------
first_member_annotation=$1
first_member_code=$2
second_member_annotation=$3
second_member_code=$4
out=$5

#---------- look for homozygous --------------

grep -v "^Func" $first_member_annotation | awk -F'\t' '{ printf "%s\t%s|%s|%s\n", $0, $22, $23, $24 }' | sort -t$'\t' -k 28 > $tmp_first_member
grep -v "^Func" $second_member_annotation | awk -F'\t' '{ printf "%s\t%s|%s|%s\n", $0, $22, $23, $24 }' | sort -t$'\t' -k 28 > $tmp_second_member
#head -5 $first_member
#echo $first_member_code
#grep "^Func" $first_member_annotation | cut -f27 --complement | awk -F'\t' '{ printf "%s\n", $0}' 
#grep "^Func" $first_member_annotation | cut -f27 --complement | awk -F'\t' -v a=$first_member_code b=second_member_code '{ printf "%s\t%s\t%s\n", $0, $a, $b }' 
#grep "^Func" $first_member_annotation | cut -f27 --complement | awk -F'\t' -v a="$first_member_code" '{ printf "%s\t%s\n", $0, a}' | awk -F'\t' -v b="$second_member_code" '{ printf "%s\t%s\n", $0, b}' > $out
join -t $'\t' -j 28 -o 1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,1.10,1.11,1.12,1.13,1.14,1.15,1.16,1.17,1.18,1.19,1.20,1.21,1.22,1.23,1.24,1.25,1.26,1.27,2.27 $tmp_first_member $tmp_second_member > $tmp_common_mutations
grep "^Func" $first_member_annotation | cut -f27 --complement | awk -F'\t' -v a="$first_member_code" '{ printf "%s\t%s\n", $0, a}' | awk -F'\t' -v b="$second_member_code" '{ printf "%s\t%s\n", $0, b}' > $out
awk -F'\t' '$8>0 { print $0}' $tmp_common_mutations | sort -t$'\t' -k8 -r >> $out
awk -F'\t' '$8<=0 { print $0}' $tmp_common_mutations | sort -t$'\t' -k27 >> $out
